                    UniFlash's version 1.17 documentation.
                    --------------------------------------
               (C) 1998 Pascal Van Leeuwen and Galkowski Adam

"Your program just saved the day for me!
 I tried to use AWDFLASH.exe to flash my new Shuttle HOT-603 v2.0(AMD640)
 with the new 603WWQ07.bin BIOS and it did! The only problem was that the
 BIN file wasn't complete.
 Evidently this destroyed the boot block too. I tried to restore the old
 BIOS to that EEPROM on a HOT-565(430TX) with all the other flash
 programs I could get my hands on to no avail. I was able to flash the
 HOT-603's EEPROM to 565WIQ0E.bin and it worked just fine on the HOT-565
 so I knew the chip it's self was still good. I finally gave up and
 ordered a replacement chip this morning. This evening while surfing I
 saw a  reference to you'r program on http://ping.be and downloaded it.
 With the 'Expert' mode I was able to properly flash the Winbond
 W29EE011-15 chip on the HOT-565 for the HOT-603."
 - Jack Freeman


0.0            DISCLAIMER
-------------------------
WARNING:
THIS PROGRAM COMMUNICATES WITH THE CHIPSET AND FLASH ROM CHIP AT THE LOWEST
HARDWARE LEVEL. WE INFORM YOU THAT THE PURPOSE OF THIS PROGRAM MAY BE
DANGEROUS TO YOUR COMPUTER'S BIOS IF NOT USED PROPERLY. THEREFORE USE IT AT
YOUR OWN RISK:  WE (THE AUTHORS) ARE _NOT_RESPONSIBLE_ FOR ANY DAMAGE THIS
PROGRAM MAY CAUSE TO YOU !!!.


0.1            COPYRIGHT and CO.
--------------------------------

This program is public domain. You may do whatever you want with it: copy it,
delete it, rip it, modify it, etc...
If you do something with it, it would be great if you credited us.


1.0            UniFlash? UNIFLASH??? What the HELL is it ??!!!
--------------------------------------------------------------

UniFlash is a flash program, used to write a new BIOS on your FLASH ROM Chip.
What's new there? , you may ask, there are already programs like this on
InterNet made by BIG BRANDS like AMI, AWARD or MR. Well... there is only a
little difference: COMPLETE, WORKING SOURCE CODE IN PASCAL IS GIVEN FOR FREE!!

Another thing: this flasher is mainly destinated for fearless people and
experienced users. If it's your first adventure with flashing your BIOS, we
recommend you strongly using these brand flashers. You'll have to understand
we are just experienced computer users/programmers and we haven't materially
the possibility to test every routine and chips we haven't. That's the main
reason we release it. We hope people may help us in debugging and testing
routines.
NOTE by PvL: Brand name flashers have a tendency to be unstable (this is
             especially true for AWDFLASH, which f*cked up my BIOS twice
             so far, leaving me no other choice than to hot-flash) so if
             you happen to be the lucky owner of one of the TESTED flash
             chips I can really recommend using UNIFLASH instead ...


2.0            What hardware do I need for UniFlash ?
-----------------------------------------------------

Here's the minimum configuration you need to run UniFlash:
       -At least a 386 (The whole thing works in flat real mode)
       -MS DOS 4.0 and higher
       -A well known flash rom chip (SST,WinBond,Atmel,Intel,...)

Here's a list of chipsets suported or going to be supported by Uniflash:

Mfg         | Model(s)             | Comments
-----------------------------------------------------------------------------
Intel       | 430FX,HX,VX,TX,MX    | No comments It works in 99% of cases
            | 440FX,LX (not tested)| (The 440FX/LX have not been yet tested,
            | 450 KX/GX            | but should work well)
            | 434 LX/NX            | 450 & 434 not tested and may not (yet)
            |                      | work
-----------------------------------------------------------------------------
VIA         | Appollo Master       | Only VP2 has been tested so far
            | Apollo-VP            |
            | Apollo-VPX           |
            | Apollo-VP2           |
            | Apollo-VP3           |
            | Apollo-MVP3          |
            | Apollo-P6            |
            | +our buddy the VXPRO |
            | (which is a remarked |
            |  Apollo VP2)         |
-----------------------------------------------------------------------------
AMD         | AMD 640 (remarked    | Works just fine
            | Apollo VP2)          |
-----------------------------------------------------------------------------
OPTi        | Vendetta             | Not tested
-----------------------------------------------------------------------------
SiS         | 559X series          | Not supported yet. Uniflash detects it,
            | +the wondreful TXPRO2| but it doesn't handle them. (SiS doesn't
            |                      | put his datasheets on free access. You
            |                      | have to register. It's free, but it
            |                      | doesn't work for me)
            |                      |*If your BIOS is an AMI WinBIOS, try
            |                      |running Uniflash with the -AMI parameter
-----------------------------------------------------------------------------
Ali         | Alladin series plus  | Not supported yet. For the datasheets,
            | the lovely TXPRO     | same situation as for SiS, but it's
            |                      | even worse.
            |                      |*If your BIOS is an AMI WinBIOS, try
            |                      |running Uniflash with the -AMI parameter


NEW!: The version 1.16d+ includes support for AMI's Flash Interface. It
allows you to flash even if you have an unknown chipset (new AMI WinBIOS is
necessary to use this feature). Uniflash will automatically try to use
this feature if there's no chipset detected. You can force using this mode,
even if your chipset is recognised by giving the -AMI parameter.



3.0            What flash chips are supported by UniFlash ?
-----------------------------------------------------------

UniFlash supports the following flash chips:
(* means tested and functional,
 # means tested, but doesn't work the way it should,
 ? means not tested at all (note that a lot of chips are very similar
to one another though, so if one of them works then the rest should work
fine too))


                AMD
                ---
                Am29F100T
               *Am29F010
                Am29F080B
                Am29F400AT
                Am29F400BT
                Am29LV004T
                Am29LV400T
                Am29F400AB
                Am29F400BB
                Am29LV004B
                Am29LV400B
                Am29F002T
                Am29F002NT
                Am29F200AT
                Am29LV200T
                Am29LV002T
                Am29F002B
                Am29F002NB
                Am29F200AB
                Am29LV200B
                Am29LV002B
                Am29F040B
                Am29F800BT
                Am29F800BB
                Am28F010
                Am28F010A
                Am28F020
                Am28F020A
                Am28F256
                Am28F256A
                Am28F512
                Am28F512A

                SST
                ---
                28x040 series
               *29EE010
                29x010 series
                29EE020
                29x020 series
                29x512 series
                29EE512
                28EE011

                Winbond
                -------
               *W29EE011
                W29C020
                W29EE512
                W29C101
                W29C010

                Atmel
                -----
               *AT49BV010
                AT49F1025
                AT49x020 series
                AT49F040
                AT49F010
                AT49F080
                AT29C040A
                AT29C1024
                AT29LV1024
                AT49F080T
                AT29xV010A series
                AT29xV020 series
                AT29LV256
                AT29xV040A series
               *AT29C010A
                AT29C020
                AT29C256
                AT29C257
                AT29C512

                Intel
                -----
               ?28F010
               *28F001BX-T
               *28F001BN-T
                28F001BX-B
                28F001BN-B
                28F200-T series
                28F200-B series
                28F002-T series
                28F002-B series

                Catalyst
                --------
               ?CAT28F150T
                CAT28F150B
               *CAT28F001T
               *CAT28F001B
                CAT28F002T
                CAT28F002B

                Macronix
                --------
               *MXIC28F1000AP
                MXIC28F1000P
                MXIC28F1000PPC

                Texas Instruments
                -----------------
                Texas Instruments chips will be recognised as AMD or INTEL
chips. It seems unbelieveable, but TI uses the same Mfg&device codes as AMD
and Intel ! But since the command set is nearly the same, it should work.

4.0            Help! I don't understand the sources !!!
-------------------------------------------------------

If you have problems understanding something mail us (address at the end).
Have a look also on the ADDCHIP.FAQ file. It explains how to add new chips
plus some details.


5.0            Expert mode
--------------------------

We included something called expert mode. If you're just a user don't enter
it (unless you have to ...).  The expert mode adds some new functions that
allow you to overwrite the bootblock (which is not normally possible) -
plus some other advanced fuctions.
To enter expert mode type "uniflash /EXPERT".
NOTE: Sometimes it may actually be NECESSARY to overwrite the bootblock because
      one BIOS mfg's bootblock may very well be incompatible with another
      BIOS mfg's BIOS ! (this is usually the case when you get a 'BOOTBLOCK
      MISMATCH' error message ...)

5.1            Making an emergency disk
---------------------------------------

It is always nice to have an emergency disk handy in case something goes
wrong. You see, most flash BIOS's incorporate something called a 'boot block'
and UNIFLASH will not normally overwrite it so it remains intact.
The boot block contains just enough code to boot up your computer with basic
peripheral support to enable you to flash in a working BIOS in case something
went wrong.

To make an emergency disk one would do the following:
-make a *DOS* system disk (NOT Win'95) using "format a: /S"
-copy uniflash to that disk
-copy a working bios image (preferably a backup that was made while the system
 was still a-ok) to the disk
-make an AUTOEXEC.BAT containing:
@UNIFLASH -E <name of BIOS image file>

(NOTE: Whatever you do, do *NOT* load HIMEM.SYS. The boot block lacks support
       routines that HIMEM.SYS requires, resulting in very nice crashes.
       And I know from experience ... !! In general, keep the boot disk as
       clean as possible (just the way it is after "format a: /S")            )

Make sure UNIFLASH and the BIOS image are on the disk as the boot block only
supports the floppy drive, you won't be able to access any harddrive !!
When you boot from this emergency disk the working BIOS image will
automatically (without any intervention by you) be flashed into the flash ROM
by UNIFLASH. This is very convenient as the boot block has no support for PCI
video cards, so you won't be able to SEE anything in the process unless you
replace your PCI videocard with an old ISA one (hint!).
UNIFLASH will give you some audible feedback, though:

first short beep: UNIFLASH invoked, reading BIOS image
second short beep: done reading BIOS image, starting to flash
double short beep: done flashing, reset your system
long continuous beep: some error occured, press any key to retry operation


6.0            How to support UniFlash?
---------------------------------------

If you want to help us in adding support for new chips, in testing the whole
thing or bugfixing, mail us BOTH!!, we'll put your name in credits at the end.
We want your opinions & experiences to make flashing BIOS an easy and safe
operation, where you doesn't need tons of flashers (if you multiply the
number of chipsets by the number of flash rom memories available, you'll 
understand better what we're talking about).

7.0            Credits
---------------------------------------

Pascal van Leeuwen - Made first design, chipset handling routines, a primitive
write function for SST, WINBOND and INTEL, added flat real mode, etc...
Improved SST & Winbond routines, made AMD routines work, added Atmel support,
added lots & lots of flash chips (of which most are currently untested ...)
Added reliability improvements (backup of old BIOS, verify after write)
Tested both Winbond & SST chips, became an expert at hot-flashing ;-)

Galkowski Adam - Initiated the UniFlash project, made modular structure, made
the current design, added functions handling DMI, PnP and bootblock, added
expert mode, made the previous crappy AMD support, wrote this doc, tested SST
routines, had multiple rendez-vous with "Award BootBlock BIOS",
advertised, etc...



8.0            How to contact us
--------------------------------

If you want to contact us, please write to BOTH of us (send the same letter at
two different addresses) with the subject UNIFLASH project.

- Pascal van Leeuwen
web    : http://ourworld.compuserve.com/homepages/pvanleeuwen/index.htm
email  : pvanleeuwen@csi.com

- Galkowski Adam
email  : 100665.2705@compuserve.com

BTW: New versions should be on:
1)   http://ourworld.compuserve.com/homepages/pvanleeuwen/ufhome.htm

2)   http://www.ping.be/bios/   (A page by Wim Bervoets, a very good page
for maniacs of flashing, I suggest you to have a look there)


9.0            Revision info
----------------------------
1.17b          -fixed a bug in the -FORCE option, should work now
               -still having trouble correctly detecting flash chips,
                we can use all the input we can get on which chips are
                and aren't correctly identified by UNIFLASH !
1.17           -pre-1.20 release because of some important fixes,
                still working on some things we promised for 1.20, though
               -fixed flashing problems with Macronix & AMD chips
               -Integrated English & French version into one executable
                to avoid having to keep 2 versions synchronized
               -Cleaned up chipset detection
               -known bugs: chip detection still not 100% accurate
                (we're working on it, this will be fixed in v1.20)
1.16d          -Added AMI Flash Interface support
               -Added the "Additional BIOS Info" option
               -Added the Macronix MXIC 28F1000PPC/12V chip
               (not officially released by Adam's request)
1.16c          -Made the detection routine more accurate
1.16b          -Removed some (debugging?) code that messed up detection
1.16           -Fixed a stupid bug in the chip detection part, which made it
               impossible to identify Atmel chips, for example.
               -Tried to add TI chips and after long hours of work and of
               downloading datasheets figured out that TI chips are just
               "remarked" AMD & Intel chips (the same Mfg & Id numbers),
               so TI chips will be recognised as AMD or Intel ones.
               -Made the source code clearer. Wrote a FAQ explaining how
               to add your own chips.
               -Added the Intel 28F010/12V and 28F020/12V chips
               -Translation of the whole thing to french. The english 1.16
               version equals french 1.00FRENCH version
1.15           -Fixed problems with AMD flash chips
               -Added VIA 82C570 chipset support
               -Tested Intel 28F001BX-T/28F001BN-T support
               TO DO before final release of V1.15: fix extended memory
                     detection, does not work ok on a friends' system ...
1.14           -Added Macronix support
               -Added SST 28EE011 flash chip
               -Added AMD Am28F010, Am28F010A, Am28F020, Am28F020A, Am28F256
                Am28F256A, Am28F512 and Am28F512A flash chips
               -Removed valid PCI ROM check so it is possible to flash a
                ROM on a PCI card that does not (yet) contain a valid ROM
               -Added some safety stuff:
                -cache disabled during flashing (having the cache enabled
                 seems to be a problem with some Cyrix chips (or chip/chipset
                 combo's ?))
                -interrupts now fully disabled during actual communication with
                 the flash chip for increased reliability
               -added multiple flash chips/single ROM image support
                (experimental)
1.13           -Added Catalyst support
               -Added OPTi chipset support (for 82C750 'Vendetta')
               -Added Intel 28F400/28F004 flash chips
               -Completely rewrote PCI option ROM support (still experimental)
1.12           -Fixed problem ID-ing Intel chips (oops)
               -Made first attempt at supporting PCI option ROMS (experimental)
1.11           -Added Atmel support
1.1            -Fixed memory allocation bug with sectored (Intel,AMD) flash ROM
                chips
               -Added VIA chipset support
1.0            -First public release




10.0           Compatibility
-----------------------------

Here is a list of tested & working motherboards. Please add yours when
Uniflash runs flawlessly on your system.

Mfg           | Model + revision  | Chipset used | Flash ROM chip used
--------------------------------------------------------------------------
ASUSTeK       | T2P4 rev 2 & 3.10 | Intel HX     | SST 29EE010/5V
Expertboard   | 8661 rev ?        | Intel VX     | WinBond W29EE011/5V
Soyo          | 5TA2 rev ?        | Intel FX     | SST 29EE010/5V
Shuttle       | Hot569 rev 2      | Intel TX     | Atmel 29C010A/5V
Shuttle       | Hot565 rev ?      | Intel TX     | Winbond W29EE011
Shuttle       | Hot603 rev ?      | AMD 640      | Winbond W29EE011


11.0            Beta testing stuff
----------------------------------

We would like to extend our thanx to the following people who've been
very helpful with beta testing this program.
NOTE: YOU can be on this list too ! All you have to do is send us
information on a system where UNIFLASH doesn't work and help us with
getting it to work on that system.
Please help us in making UNIFLASH the universal and reliable tool we had
in mind when we started this project. Thanx in advance !

                The 100 heroes gallery (random order)
                -------------------------------------
                Enrico Antongiovanni
                Wim Bervoets
                Michael L. Croswell
                Polyvios Simopoulos
                Matthias David Siebler


12.0            Biz support
---------------------------

We would like to thank the following people at the various flash ROM
and chipset manufacturers for their support (in random order):

                Scotts Chen at Macronix International Co., Ltd.

